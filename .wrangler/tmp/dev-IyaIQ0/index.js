var __defProp = Object.defineProperty;
var __name = (target, value) => __defProp(target, "name", { value, configurable: true });

// src/data/mathCurriculum.ts
var mathCurriculum = {
  "grade-1": {
    id: "grade-1",
    name: "Grade 1 (Year 1)",
    description: "Introduction to basic mathematical concepts",
    topics: [
      {
        id: "number",
        name: "Number",
        subtopics: [
          "Count, read, and write numbers up to 100",
          "Compare and order numbers up to 100",
          "Addition and subtraction within 20",
          "Introduction to multiplication (repeated addition)",
          "Understanding halves and quarters (fractions)"
        ]
      },
      {
        id: "geometry",
        name: "Geometry",
        subtopics: [
          "Recognize and name 2D and 3D shapes",
          "Describe position and direction (left, right, up, down)"
        ]
      },
      {
        id: "measurement",
        name: "Measurement",
        subtopics: [
          "Compare lengths, mass, and capacity using non-standard units",
          "Tell the time to the hour and half-hour",
          "Recognize coins and simple money addition"
        ]
      },
      {
        id: "data-handling",
        name: "Data Handling",
        subtopics: [
          "Sort and classify objects",
          "Use pictograms and simple tables"
        ]
      },
      {
        id: "problem-solving",
        name: "Problem Solving",
        subtopics: [
          "Apply addition/subtraction in simple word problems"
        ]
      }
    ]
  },
  "grade-2": {
    id: "grade-2",
    name: "Grade 2 (Year 2)",
    description: "Building on foundational math skills",
    topics: [
      {
        id: "number",
        name: "Number",
        subtopics: [
          "Count, read, and write numbers up to 1000",
          "Addition and subtraction within 100",
          "Multiplication and division facts (2, 5, 10)",
          "Fractions: halves, quarters, and thirds"
        ]
      },
      {
        id: "geometry",
        name: "Geometry",
        subtopics: [
          "Recognize and describe properties of 2D and 3D shapes",
          "Identify lines of symmetry"
        ]
      },
      {
        id: "measurement",
        name: "Measurement",
        subtopics: [
          "Use standard units: cm, m, g, kg, ml, l",
          "Tell time to the quarter hour",
          "Money: simple change calculations"
        ]
      },
      {
        id: "data-handling",
        name: "Data Handling",
        subtopics: [
          "Collect and present data using tally charts and bar charts"
        ]
      },
      {
        id: "problem-solving",
        name: "Problem Solving",
        subtopics: [
          "Multi-step word problems with addition and subtraction"
        ]
      }
    ]
  },
  // Add more grades following the same pattern
  // I'll add a few more grades as examples
  "grade-3": {
    id: "grade-3",
    name: "Grade 3 (Year 3)",
    description: "Expanding mathematical understanding",
    topics: [
      {
        id: "number",
        name: "Number",
        subtopics: [
          "Numbers up to 10,000",
          "Addition and subtraction with carrying/borrowing",
          "Multiplication and division facts (up to 10 \xD7 10)",
          "Fractions: halves, thirds, quarters, tenths"
        ]
      },
      {
        id: "geometry",
        name: "Geometry",
        subtopics: [
          "Identify angles (right, acute, obtuse)",
          "Perimeter of simple shapes"
        ]
      },
      {
        id: "measurement",
        name: "Measurement",
        subtopics: [
          "Time: to the nearest 5 minutes",
          "Length, mass, capacity in metric units"
        ]
      },
      {
        id: "data-handling",
        name: "Data Handling",
        subtopics: [
          "Interpret bar charts and tables"
        ]
      },
      {
        id: "problem-solving",
        name: "Problem Solving",
        subtopics: [
          "Two-step problems in all four operations"
        ]
      }
    ]
  },
  "grade-4": {
    id: "grade-4",
    name: "Grade 4 (Year 4)",
    description: "Developing more complex math skills",
    topics: [
      {
        id: "number",
        name: "Number",
        subtopics: [
          "Numbers up to 100,000",
          "Formal written methods for addition/subtraction",
          "Multiplication/division with larger numbers",
          "Fractions and decimals (tenths, hundredths)"
        ]
      },
      {
        id: "geometry",
        name: "Geometry",
        subtopics: [
          "Angles: measure and compare",
          "Symmetry and reflection",
          "Area and perimeter"
        ]
      },
      {
        id: "measurement",
        name: "Measurement",
        subtopics: [
          "Convert units (cm to m, g to kg, ml to l)",
          "Time: digital and analogue to the minute"
        ]
      },
      {
        id: "data-handling",
        name: "Data Handling",
        subtopics: [
          "Line graphs and pictograms"
        ]
      },
      {
        id: "problem-solving",
        name: "Problem Solving",
        subtopics: [
          "Apply number facts to real-life problems"
        ]
      }
    ]
  },
  "grade-5": {
    id: "grade-5",
    name: "Grade 5 (Year 5)",
    description: "Advanced mathematical concepts and applications",
    topics: [
      {
        id: "number",
        name: "Number",
        subtopics: [
          "Numbers up to 1,000,000",
          "Negative numbers in context",
          "Multiplying and dividing by 10, 100, 1000",
          "Fractions: equivalent fractions, addition, and subtraction",
          "Decimals and percentages"
        ]
      },
      {
        id: "geometry",
        name: "Geometry",
        subtopics: [
          "Properties of triangles and quadrilaterals",
          "Coordinates (first quadrant)",
          "Angle sums in polygons"
        ]
      },
      {
        id: "measurement",
        name: "Measurement",
        subtopics: [
          "Area and perimeter of rectangles and compound shapes",
          "Volume and capacity"
        ]
      },
      {
        id: "data-handling",
        name: "Data Handling",
        subtopics: [
          "Interpret line graphs and simple pie charts"
        ]
      },
      {
        id: "problem-solving",
        name: "Problem Solving",
        subtopics: [
          "Multi-step problems with mixed operations"
        ]
      }
    ]
  },
  "grade-6": {
    id: "grade-6",
    name: "Grade 6 (Year 6)",
    description: "Mastery of primary mathematics concepts",
    topics: [
      {
        id: "number",
        name: "Number",
        subtopics: [
          "Numbers beyond 1,000,000",
          "Prime numbers, factors, multiples",
          "Ratio and proportion",
          "Fractions: multiply/divide fractions",
          "Decimals: 4 operations",
          "Percentages and their equivalence with fractions/decimals"
        ]
      },
      {
        id: "geometry",
        name: "Geometry",
        subtopics: [
          "Coordinates in four quadrants",
          "Transformations: translation, reflection, rotation",
          "Area of triangles and parallelograms"
        ]
      },
      {
        id: "measurement",
        name: "Measurement",
        subtopics: [
          "Converting between units (metric)",
          "Volume of cubes and cuboids"
        ]
      },
      {
        id: "data-handling",
        name: "Data Handling",
        subtopics: [
          "Mean, median, mode, and range",
          "Complex bar and line graphs"
        ]
      },
      {
        id: "problem-solving",
        name: "Problem Solving",
        subtopics: [
          "Real-life problems involving percentages, ratio, and algebraic reasoning"
        ]
      }
    ]
  }
};
var getRandomSubtopic = /* @__PURE__ */ __name((gradeId) => {
  const grade = mathCurriculum[gradeId];
  if (!grade) return null;
  const topic = grade.topics[Math.floor(Math.random() * grade.topics.length)];
  if (!topic || topic.subtopics.length === 0) return null;
  const subtopic = topic.subtopics[Math.floor(Math.random() * topic.subtopics.length)];
  return subtopic;
}, "getRandomSubtopic");

// worker/index.ts
function withCORS(data, status = 200) {
  return new Response(JSON.stringify(data), {
    status,
    headers: {
      "Content-Type": "application/json",
      "Access-Control-Allow-Origin": "*",
      // âœ… izinkan semua origin
      "Access-Control-Allow-Methods": "GET,POST,OPTIONS",
      "Access-Control-Allow-Headers": "Content-Type, Authorization"
    }
  });
}
__name(withCORS, "withCORS");
var worker_default = {
  async fetch(req, env) {
    const url = new URL(req.url);
    if (req.method === "OPTIONS") {
      return new Response(null, {
        status: 204,
        headers: {
          "Access-Control-Allow-Origin": "*",
          "Access-Control-Allow-Methods": "GET,POST,OPTIONS",
          "Access-Control-Allow-Headers": "Content-Type, Authorization"
        }
      });
    }
    if (url.pathname.startsWith("/api/chat") && req.method === "POST") {
      const { message } = await req.json();
      const res = await fetch("https://api.deepseek.com/chat/completions", {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${env.DEEPSEEK_KEY}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          model: "deepseek-chat",
          messages: [
            {
              role: "system",
              content: `You are an educational assistant. 
You must only answer questions about education (school, study tips, child learning, math, science, subjects, exam prep, saving for children's education).
If a user asks outside of education, politely decline and remind them you can only help with educational topics. 
Keep your tone friendly and simple.`
            },
            { role: "user", content: message }
          ]
        })
      });
      const data = await res.json();
      return withCORS({
        reply: data.choices?.[0]?.message?.content ?? "\u26A0\uFE0F No reply"
      });
    }
    if (url.pathname.startsWith("/api/question") && req.method === "POST") {
      const { grade } = await req.json();
      const gradeId = `grade-${grade}`;
      const gradeData = mathCurriculum[gradeId];
      if (!gradeData) {
        return withCORS({ questions: [] });
      }
      const subtopic = getRandomSubtopic(gradeId) || "general math";
      const prompt = `
      Generate 5 multiple-choice questions for ${gradeData.name} students
      based on the Cambridge curriculum subtopic: "${subtopic}".

      Rules:
      - Strictly align with Cambridge curriculum.
      - Provide 4 options (A\u2013D).
      - Ensure one correctAnswer is included in the options.
      - Add a short explanation (1\u20132 sentences).
      - Return valid JSON only.

      Format:
      {
        "questions": [
          {
            "question": "Question text",
            "options": ["Option A", "Option B", "Option C", "Option D"],
            "correctAnswer": "Correct option text",
            "explanation": "1\u20132 sentences explanation",
            "topic": "${subtopic}"
          }
        ]
      }
      `;
      const res = await fetch("https://api.deepseek.com/chat/completions", {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${env.DEEPSEEK_KEY}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          model: "deepseek-chat",
          messages: [{ role: "user", content: prompt }]
        })
      });
      const data = await res.json();
      const content = data.choices?.[0]?.message?.content ?? "{}";
      let parsed = { questions: [] };
      try {
        parsed = JSON.parse(content.replace(/```json|```/g, "").trim());
      } catch {
      }
      return withCORS(
        parsed.questions?.length ? parsed : {
          questions: [
            {
              question: "2 + 3 = ?",
              options: ["4", "5", "6", "7"],
              correctAnswer: "5",
              explanation: "Adding 2 and 3 gives 5.",
              topic: subtopic
            }
          ]
        }
      );
    }
    if (url.pathname.startsWith("/api/explain") && req.method === "POST") {
      const { question, wrongAnswer, grade } = await req.json();
      const prompt = `
      A grade ${grade} student answered this incorrectly.
      Question: ${question}
      Wrong Answer: ${wrongAnswer}
      Explain why it's wrong and give the correct step-by-step solution.
      `;
      const res = await fetch("https://api.deepseek.com/chat/completions", {
        method: "POST",
        headers: {
          "Authorization": `Bearer ${env.DEEPSEEK_KEY}`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          model: "deepseek-chat",
          messages: [{ role: "user", content: prompt }],
          temperature: 0.6
        })
      });
      const data = await res.json();
      return withCORS({
        explanation: data.choices?.[0]?.message?.content ?? "\u26A0\uFE0F No explanation"
      });
    }
    return withCORS({ error: "Not Found" }, 404);
  }
};

// node_modules/.pnpm/wrangler@4.37.0/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts
var drainBody = /* @__PURE__ */ __name(async (request, env, _ctx, middlewareCtx) => {
  try {
    return await middlewareCtx.next(request, env);
  } finally {
    try {
      if (request.body !== null && !request.bodyUsed) {
        const reader = request.body.getReader();
        while (!(await reader.read()).done) {
        }
      }
    } catch (e) {
      console.error("Failed to drain the unused request body.", e);
    }
  }
}, "drainBody");
var middleware_ensure_req_body_drained_default = drainBody;

// node_modules/.pnpm/wrangler@4.37.0/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts
function reduceError(e) {
  return {
    name: e?.name,
    message: e?.message ?? String(e),
    stack: e?.stack,
    cause: e?.cause === void 0 ? void 0 : reduceError(e.cause)
  };
}
__name(reduceError, "reduceError");
var jsonError = /* @__PURE__ */ __name(async (request, env, _ctx, middlewareCtx) => {
  try {
    return await middlewareCtx.next(request, env);
  } catch (e) {
    const error = reduceError(e);
    return Response.json(error, {
      status: 500,
      headers: { "MF-Experimental-Error-Stack": "true" }
    });
  }
}, "jsonError");
var middleware_miniflare3_json_error_default = jsonError;

// .wrangler/tmp/bundle-bYSbRa/middleware-insertion-facade.js
var __INTERNAL_WRANGLER_MIDDLEWARE__ = [
  middleware_ensure_req_body_drained_default,
  middleware_miniflare3_json_error_default
];
var middleware_insertion_facade_default = worker_default;

// node_modules/.pnpm/wrangler@4.37.0/node_modules/wrangler/templates/middleware/common.ts
var __facade_middleware__ = [];
function __facade_register__(...args) {
  __facade_middleware__.push(...args.flat());
}
__name(__facade_register__, "__facade_register__");
function __facade_invokeChain__(request, env, ctx, dispatch, middlewareChain) {
  const [head, ...tail] = middlewareChain;
  const middlewareCtx = {
    dispatch,
    next(newRequest, newEnv) {
      return __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);
    }
  };
  return head(request, env, ctx, middlewareCtx);
}
__name(__facade_invokeChain__, "__facade_invokeChain__");
function __facade_invoke__(request, env, ctx, dispatch, finalMiddleware) {
  return __facade_invokeChain__(request, env, ctx, dispatch, [
    ...__facade_middleware__,
    finalMiddleware
  ]);
}
__name(__facade_invoke__, "__facade_invoke__");

// .wrangler/tmp/bundle-bYSbRa/middleware-loader.entry.ts
var __Facade_ScheduledController__ = class ___Facade_ScheduledController__ {
  constructor(scheduledTime, cron, noRetry) {
    this.scheduledTime = scheduledTime;
    this.cron = cron;
    this.#noRetry = noRetry;
  }
  static {
    __name(this, "__Facade_ScheduledController__");
  }
  #noRetry;
  noRetry() {
    if (!(this instanceof ___Facade_ScheduledController__)) {
      throw new TypeError("Illegal invocation");
    }
    this.#noRetry();
  }
};
function wrapExportedHandler(worker) {
  if (__INTERNAL_WRANGLER_MIDDLEWARE__ === void 0 || __INTERNAL_WRANGLER_MIDDLEWARE__.length === 0) {
    return worker;
  }
  for (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {
    __facade_register__(middleware);
  }
  const fetchDispatcher = /* @__PURE__ */ __name(function(request, env, ctx) {
    if (worker.fetch === void 0) {
      throw new Error("Handler does not export a fetch() function.");
    }
    return worker.fetch(request, env, ctx);
  }, "fetchDispatcher");
  return {
    ...worker,
    fetch(request, env, ctx) {
      const dispatcher = /* @__PURE__ */ __name(function(type, init) {
        if (type === "scheduled" && worker.scheduled !== void 0) {
          const controller = new __Facade_ScheduledController__(
            Date.now(),
            init.cron ?? "",
            () => {
            }
          );
          return worker.scheduled(controller, env, ctx);
        }
      }, "dispatcher");
      return __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);
    }
  };
}
__name(wrapExportedHandler, "wrapExportedHandler");
function wrapWorkerEntrypoint(klass) {
  if (__INTERNAL_WRANGLER_MIDDLEWARE__ === void 0 || __INTERNAL_WRANGLER_MIDDLEWARE__.length === 0) {
    return klass;
  }
  for (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {
    __facade_register__(middleware);
  }
  return class extends klass {
    #fetchDispatcher = /* @__PURE__ */ __name((request, env, ctx) => {
      this.env = env;
      this.ctx = ctx;
      if (super.fetch === void 0) {
        throw new Error("Entrypoint class does not define a fetch() function.");
      }
      return super.fetch(request);
    }, "#fetchDispatcher");
    #dispatcher = /* @__PURE__ */ __name((type, init) => {
      if (type === "scheduled" && super.scheduled !== void 0) {
        const controller = new __Facade_ScheduledController__(
          Date.now(),
          init.cron ?? "",
          () => {
          }
        );
        return super.scheduled(controller);
      }
    }, "#dispatcher");
    fetch(request) {
      return __facade_invoke__(
        request,
        this.env,
        this.ctx,
        this.#dispatcher,
        this.#fetchDispatcher
      );
    }
  };
}
__name(wrapWorkerEntrypoint, "wrapWorkerEntrypoint");
var WRAPPED_ENTRY;
if (typeof middleware_insertion_facade_default === "object") {
  WRAPPED_ENTRY = wrapExportedHandler(middleware_insertion_facade_default);
} else if (typeof middleware_insertion_facade_default === "function") {
  WRAPPED_ENTRY = wrapWorkerEntrypoint(middleware_insertion_facade_default);
}
var middleware_loader_entry_default = WRAPPED_ENTRY;
export {
  __INTERNAL_WRANGLER_MIDDLEWARE__,
  middleware_loader_entry_default as default
};
//# sourceMappingURL=index.js.map
